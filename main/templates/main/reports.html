{% extends 'main/base.html' %}
{% block title %}Reports{% endblock %}

{% block content %}
<h2 class="mb-4">Reports</h2>

<form method="get">
  <div class="row mb-3">
      <div class="col-md-3">
          <label>From Date</label>
          <input type="text" id="from-date" name="from_date" class="form-control" value="{{ from_date }}" placeholder="Select From Date">
      </div>
      <div class="col-md-3">
          <label>To Date</label>
          <input type="text" id="to-date" name="to_date" class="form-control" value="{{ to_date }}" placeholder="Select To Date">
      </div>
      <div class="col-md-3">
          <label>Driver</label>
          <select name="driver" class="form-control">
              <option value="">All Drivers</option>
              {% for d in drivers %}
                  <option value="{{ d }}" {% if d == selected_driver %}selected{% endif %}>{{ d }}</option>
              {% endfor %}
          </select>
      </div>
  </div>

  <div class="mb-3">
      <button type="submit" name="action" value="csv" class="btn btn-primary me-2">Download CSV</button>
      <button type="submit" name="action" value="summary" class="btn btn-success">View Summary</button>
  </div>
</form>

{% if records %}
<div class="table-responsive mt-4">
    <table class="table table-striped table-bordered">
        <thead class="table-light">
            <tr>
                <th>Date (BS)</th>
                <th>Vehicle Number</th>
                <th>Type</th>
                <th>Maintenance Cost</th>
                <th>Fuel Cost</th>
                <th>Total Cost</th>
                <th>Driver</th>
                <th>Paid To</th>
                <th>Bill Number</th>
                <th>Bill Date (BS)</th>
                <th>Remarks</th>
            </tr>
        </thead>
        <tbody>
            {% for record in records %}
            <tr>
                <td>{{ record.bs_date.year }}-{{ record.bs_date.month }}-{{ record.bs_date.day }}</td>
                <td>{{ record.vehicle_number }}</td>
                <td>{{ record.vehicle_type }}</td>
                <td>{{ record.maintenance_cost|floatformat:2 }}</td>
                <td>{{ record.fuel_cost|floatformat:2 }}</td>
                <td>{{ record.total_cost|floatformat:2 }}</td>
                <td>{{ record.driver_name }}</td>
                <td>{{ record.paid_to_company }}</td>
                <td>{{ record.bill_number }}</td>
                <td>{{ record.bs_bill_date.year }}-{{ record.bs_bill_date.month }}-{{ record.bs_bill_date.day }}</td>
                <td>{{ record.remarks }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="mt-4">
    <h5>Summary:</h5>
    <ul>
        <li>Total Maintenance Cost: {{ summary.total_maintenance|default:0|floatformat:2 }}</li>
        <li>Total Fuel Cost: {{ summary.total_fuel|default:0|floatformat:2 }}</li>
        <li>Total Cost: {{ summary.total_cost|default:0|floatformat:2 }}</li>
    </ul>
</div>
{% endif %}

<!-- Initialize Nepali Datepicker for reports page -->
<script src="https://nepalidatepicker.sajanmaharjan.com.np/v5/nepali.datepicker/js/nepali.datepicker.v5.0.6.min.js" type="text/javascript"></script>
<link href="https://nepalidatepicker.sajanmaharjan.com.np/v5/nepali.datepicker/css/nepali.datepicker.v5.0.6.min.css" rel="stylesheet" type="text/css"/>

<script type="text/javascript">
window.onload = function() {
    var fromInput = document.getElementById("from-date");
    var toInput = document.getElementById("to-date");

    if(fromInput) fromInput.NepaliDatePicker();
    if(toInput) toInput.NepaliDatePicker();
};
</script>

{% endblock %}
