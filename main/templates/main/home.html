{% extends 'main/base.html' %}

{% block title %}Home{% endblock %}

{% block content %}

<form method="post">
    {% csrf_token %}

    {# Show non-field errors (if any) #}
    {% if form.non_field_errors %}
        <div class="alert alert-danger">
            {{ form.non_field_errors }}
        </div>
    {% endif %}

    <!-- Render 'date' field as readonly -->
    <div class="mb-3">
        {{ form.date.label_tag }}
        {{ form.date }}
        {% if form.date.errors %}
            <div class="text-danger small">
                {{ form.date.errors|striptags }}
            </div>
        {% endif %}
    </div>

    <!-- Render remaining fields -->
    {% for field in form %}
        {% if field.name != 'date' %}
            <div class="mb-3">
                {{ field.label_tag }}
                {{ field }}

                {% if field.errors %}
                    <div class="text-danger small">
                        {{ field.errors|striptags }}
                    </div>
                {% endif %}
            </div>
        {% endif %}
    {% endfor %}

    <button type="submit" class="btn btn-primary">Submit</button>
</form>

<!-- Bootstrap Select for driver -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>

<!-- Nepali Datepicker only for bill_date -->
<script src="https://nepalidatepicker.sajanmaharjan.com.np/v5/nepali.datepicker/js/nepali.datepicker.v5.0.6.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {

    // Nepali Datepicker for bill_date
    var billInput = document.getElementById("bill-nepali");
    if (billInput) {
        billInput.NepaliDatePicker();
    }

    // Searchable/typeable driver dropdown
    $('.selectpicker').selectpicker();

    // Maintenance reason logic
    var maintenanceInput = document.getElementById("id_maintenance_cost");
    var reasonInput = document.getElementById("id_reason_for_maintenance");
    var reasonLabel = reasonInput.previousElementSibling;

    function toggleReasonRequirement() {
        if (parseFloat(maintenanceInput.value || 0) > 0) {
            reasonInput.required = true;
            reasonLabel.innerHTML = "Reason for Maintenance <span class='text-danger'>*</span>";
        } else {
            reasonInput.required = false;
            reasonLabel.innerHTML = "Reason for Maintenance";
        }
    }

    toggleReasonRequirement();
    maintenanceInput.addEventListener('input', toggleReasonRequirement);
});
</script>

{% endblock %}
