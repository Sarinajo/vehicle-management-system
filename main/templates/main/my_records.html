{% extends 'main/base.html' %}

{% block title %}
    {% if user.is_superuser %}Records{% else %}My Records{% endif %}
{% endblock %}

{% block content %}

<h2 class="mb-4">
    {% if user.is_superuser %}
        All Vehicle Records
    {% else %}
        My Vehicle Records
    {% endif %}
</h2>

<!-- ================= FILTER FORM ================= -->
<form method="get" class="row g-3 mb-4">
    <div class="col-md-3">
        <label>From Date (BS)</label>
        <input type="text"
               id="from-date"
               name="from_date"
               value="{{ from_date|default:'' }}"
               class="form-control">
    </div>

    <div class="col-md-3">
        <label>To Date (BS)</label>
        <input type="text"
               id="to-date"
               name="to_date"
               value="{{ to_date|default:'' }}"
               class="form-control">
    </div>

    <div class="col-md-3 align-self-end">
        <button type="submit"
                name="action"
                value="view"
                class="btn btn-gradient">
            View Records
        </button>

        <a href="{% url 'my_records' %}" class="btn btn-secondary">
            Reset
        </a>
    </div>
</form>

<!-- ================= MESSAGE ================= -->
{% if show_message %}
    <div class="alert alert-warning">
        Please select both <strong>From Date</strong> and <strong>To Date</strong>.
    </div>
{% endif %}

<!-- ================= TABLE ================= -->
{% if user_records %}
<div class="table-responsive">
<table class="table table-striped table-bordered">
    <thead class="table-light">
        <tr>
            <th>Date (BS)</th>
            <th>Vehicle Number</th>
            <th>Type</th>
            <th>Maintenance Cost</th>
            <th>Fuel Cost</th>
            <th>Total Cost</th>
            <th>Distance Traveled</th>
            <th>Driver</th>
            <th>Paid To</th>
            <th>Bill Number</th>
            <th>Bill Date (BS)</th>
            <th>Reason</th>

            {% if user.is_superuser %}
                <th>Action</th>
            {% endif %}
        </tr>
    </thead>

    <tbody>
    {% for record in user_records %}
        <tr>
            <td>
                {{ record.bs_date.year }}-
                {{ record.bs_date.month|stringformat:"02d" }}-
                {{ record.bs_date.day|stringformat:"02d" }}
            </td>
            <td>{{ record.vehicle_number }}</td>
            <td>{{ record.vehicle_type }}</td>
            <td>{{ record.maintenance_cost|floatformat:2 }}</td>
            <td>{{ record.fuel_cost|floatformat:2 }}</td>
            <td>{{ record.total_cost|floatformat:2 }}</td>
            <td>{{ record.distance_traveled|floatformat:0 }} Km</td>
            <td>{{ record.driver.name }}</td>
            <td>{{ record.paid_to_company }}</td>
            <td>{{ record.bill_number }}</td>
            <td>
                {{ record.bs_bill_date.year }}-
                {{ record.bs_bill_date.month|stringformat:"02d" }}-
                {{ record.bs_bill_date.day|stringformat:"02d" }}
            </td>
            <td>{{ record.reason_for_maintenance }}</td>

            {% if user.is_superuser %}
            <td>
                <a href="{% url 'edit_record' record.id %}"
                   class="btn btn-sm btn-warning">
                    Edit
                </a>
            </td>
            {% endif %}
        </tr>
    {% endfor %}
    </tbody>
</table>
</div>

{% elif from_date or to_date %}
    <p>No records found for the selected date range.</p>

{% else %}
    <p class="text-muted">
        Please select a date range and click <strong>View Records</strong>.
    </p>
{% endif %}

{% endblock %}